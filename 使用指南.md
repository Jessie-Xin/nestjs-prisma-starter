# ğŸš€ NestJS Prisma Starter ä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [è®¿é—®åº”ç”¨](#è®¿é—®åº”ç”¨)
- [GraphQL API ä½¿ç”¨](#graphql-api-ä½¿ç”¨)
  - [è®¤è¯æµç¨‹](#è®¤è¯æµç¨‹)
  - [ç”¨æˆ·æ“ä½œ](#ç”¨æˆ·æ“ä½œ)
  - [æ–‡ç« æ“ä½œ](#æ–‡ç« æ“ä½œ)
- [REST API ä½¿ç”¨](#rest-api-ä½¿ç”¨)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ç­‰ä¿¡æ¯ã€‚

### 3. å¯åŠ¨æ•°æ®åº“

ä½¿ç”¨ Docker å¯åŠ¨ PostgreSQL æ•°æ®åº“ï¼š

```bash
npm run docker:db
```

### 4. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
npm run migrate:dev
```

### 5. å¡«å……ç§å­æ•°æ®

é¡¹ç›®ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹æµ‹è¯•ç”¨æˆ·ï¼š

```bash
npm run seed
```

**é»˜è®¤æµ‹è¯•è´¦å·ï¼š**

- **ç®¡ç†å‘˜è´¦å·**
  - Email: `bart@simpson.com`
  - Password: `secret42`
  - Role: ADMIN

- **æ™®é€šç”¨æˆ·**
  - Email: `lisa@simpson.com`
  - Password: `secret42`
  - Role: USER

### 6. å¯åŠ¨åº”ç”¨

```bash
# å¼€å‘æ¨¡å¼ï¼ˆå¸¦çƒ­é‡è½½ï¼‰
npm run start:dev

# ç”Ÿäº§æ¨¡å¼
npm run build
npm run start:prod
```

---

## è®¿é—®åº”ç”¨

å¯åŠ¨æˆåŠŸåï¼Œä½ ä¼šåœ¨ç»ˆç«¯çœ‹åˆ°ï¼š

```
ğŸš€ åº”ç”¨å¯åŠ¨æˆåŠŸï¼

ğŸ“ åº”ç”¨åœ°å€: http://localhost:3000
ğŸ® GraphQL Playground: http://localhost:3000/graphql
ğŸ“š Swagger æ–‡æ¡£: http://localhost:3000/api
```

- **GraphQL Playground**: ä¸»è¦ API æ¥å£ï¼Œç”¨äºæ‰€æœ‰ä¸šåŠ¡æ“ä½œ
- **Swagger æ–‡æ¡£**: REST API æ–‡æ¡£ï¼ˆä»…å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼‰
- **åº”ç”¨åœ°å€**: æ ¹è·¯å¾„å¥åº·æ£€æŸ¥

---

## GraphQL API ä½¿ç”¨

### è®¿é—® GraphQL Playground

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:3000/graphql`

GraphQL Playground æä¾›ï¼š
- âœ… è‡ªåŠ¨è¡¥å…¨
- âœ… å®Œæ•´çš„ Schema æ–‡æ¡£
- âœ… æŸ¥è¯¢å†å²
- âœ… å®æ—¶è®¢é˜…æµ‹è¯•

---

## è®¤è¯æµç¨‹

### 1. ç”¨æˆ·æ³¨å†Œ

åœ¨ GraphQL Playground ä¸­æ‰§è¡Œï¼š

```graphql
mutation Signup {
  signup(data: {
    email: "test@example.com",
    password: "mypassword123"
  }) {
    accessToken
    refreshToken
    user {
      id
      email
      role
    }
  }
}
```

### 2. ç”¨æˆ·ç™»å½•

ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•ï¼š

```graphql
mutation Login {
  login(data: {
    email: "test@example.com",
    password: "mypassword123"
  }) {
    accessToken
    refreshToken
    user {
      id
      email
      firstname
      lastname
      role
    }
  }
}
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "data": {
    "login": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "user": {
        "id": "clx123...",
        "email": "bart@simpson.com",
        "firstname": "Bart",
        "lastname": "Simpson",
        "role": "ADMIN"
      }
    }
  }
}
```

### 3. è®¾ç½®è®¤è¯ Token

ç™»å½•æˆåŠŸåï¼Œå°† `accessToken` æ·»åŠ åˆ° HTTP Headersï¼š

1. åœ¨ GraphQL Playground åº•éƒ¨æ‰¾åˆ° **HTTP HEADERS** æ ‡ç­¾
2. æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```json
{
  "Authorization": "Bearer YOUR_ACCESS_TOKEN"
}
```

**ç¤ºä¾‹ï¼š**

```json
{
  "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbHgxMjMuLi4ifQ..."
}
```

### 4. åˆ·æ–° Token

å½“ `accessToken` è¿‡æœŸï¼ˆ2 åˆ†é’Ÿï¼‰åï¼Œä½¿ç”¨ `refreshToken` è·å–æ–°çš„ tokenï¼š

```graphql
mutation RefreshToken {
  refreshToken(token: "YOUR_REFRESH_TOKEN") {
    accessToken
    refreshToken
  }
}
```

---

## ç”¨æˆ·æ“ä½œ

### æŸ¥è¯¢å½“å‰ç”¨æˆ·ä¿¡æ¯

**éœ€è¦è®¤è¯** ğŸ”’

```graphql
query Me {
  me {
    id
    email
    firstname
    lastname
    role
    createdAt
    updatedAt
  }
}
```

### æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**éœ€è¦è®¤è¯** ğŸ”’

```graphql
mutation UpdateUser {
  updateUser(data: {
    firstname: "å¼ ",
    lastname: "ä¸‰"
  }) {
    id
    email
    firstname
    lastname
  }
}
```

### ä¿®æ”¹å¯†ç 

**éœ€è¦è®¤è¯** ğŸ”’

```graphql
mutation ChangePassword {
  changePassword(data: {
    oldPassword: "secret42",
    newPassword: "newpassword123"
  }) {
    id
    email
  }
}
```

---

## æ–‡ç« æ“ä½œ

### åˆ›å»ºæ–‡ç« 

**éœ€è¦è®¤è¯** ğŸ”’

```graphql
mutation CreatePost {
  createPost(data: {
    title: "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ",
    content: "è¿™æ˜¯æ–‡ç« å†…å®¹..."
  }) {
    id
    title
    content
    published
    createdAt
    author {
      id
      email
      firstname
      lastname
    }
  }
}
```

### æŸ¥è¯¢å·²å‘å¸ƒæ–‡ç« ï¼ˆåˆ†é¡µï¼‰

**å…¬å¼€æ¥å£** âœ…

```graphql
query PublishedPosts {
  publishedPosts(
    first: 10
    orderBy: { field: createdAt, direction: desc }
  ) {
    totalCount
    edges {
      cursor
      node {
        id
        title
        content
        createdAt
        author {
          id
          firstname
          lastname
        }
      }
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}
```

### æŸ¥è¯¢å•ç¯‡æ–‡ç« 

**å…¬å¼€æ¥å£** âœ…

```graphql
query Post {
  post(postId: "POST_ID_HERE") {
    id
    title
    content
    published
    createdAt
    updatedAt
    author {
      id
      email
      firstname
      lastname
    }
  }
}
```

### æŸ¥è¯¢æŒ‡å®šç”¨æˆ·çš„æ–‡ç« 

**éœ€è¦è®¤è¯** ğŸ”’

```graphql
query UserPosts {
  userPosts(userId: "USER_ID_HERE") {
    id
    title
    content
    published
    createdAt
  }
}
```

### æ›´æ–°æ–‡ç« 

**éœ€è¦è®¤è¯** ğŸ”’ï¼ˆåªèƒ½æ›´æ–°è‡ªå·±çš„æ–‡ç« ï¼‰

```graphql
mutation UpdatePost {
  updatePost(
    postId: "POST_ID_HERE"
    data: {
      title: "æ›´æ–°çš„æ ‡é¢˜",
      content: "æ›´æ–°çš„å†…å®¹"
    }
  ) {
    id
    title
    content
    updatedAt
  }
}
```

### å‘å¸ƒæ–‡ç« 

**éœ€è¦è®¤è¯** ğŸ”’

```graphql
mutation PublishPost {
  publishPost(postId: "POST_ID_HERE") {
    id
    title
    published
  }
}
```

### åˆ é™¤æ–‡ç« 

**éœ€è¦è®¤è¯** ğŸ”’ï¼ˆåªèƒ½åˆ é™¤è‡ªå·±çš„æ–‡ç« ï¼‰

```graphql
mutation DeletePost {
  deletePost(postId: "POST_ID_HERE") {
    id
    title
  }
}
```

---

## å®æ—¶è®¢é˜… (Subscriptions)

### è®¢é˜…æ–°æ–‡ç« åˆ›å»º

åœ¨ GraphQL Playground ä¸­æµ‹è¯•å®æ—¶è®¢é˜…ï¼š

```graphql
subscription PostCreated {
  postCreated {
    id
    title
    content
    createdAt
    author {
      id
      firstname
      lastname
    }
  }
}
```

**ä½¿ç”¨æ­¥éª¤ï¼š**

1. åœ¨å·¦ä¾§ç¼–è¾‘å™¨è¾“å…¥è®¢é˜…æŸ¥è¯¢
2. ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¯åŠ¨è®¢é˜…
3. åœ¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µåˆ›å»ºæ–°æ–‡ç« 
4. å›åˆ°è®¢é˜…æ ‡ç­¾ï¼Œå¯ä»¥çœ‹åˆ°å®æ—¶æ¨é€çš„æ•°æ®

---

## REST API ä½¿ç”¨

### å¥åº·æ£€æŸ¥

```bash
# åŸºç¡€å¥åº·æ£€æŸ¥
curl http://localhost:3000

# å“åº”: "Hello World!"
```

### ä¸ªæ€§åŒ–é—®å€™

```bash
curl http://localhost:3000/hello/å¼ ä¸‰

# å“åº”: "Hello å¼ ä¸‰"
```

### Swagger æ–‡æ¡£

è®¿é—® `http://localhost:3000/api` æŸ¥çœ‹å®Œæ•´çš„ REST API æ–‡æ¡£ã€‚

---

## å¸¸è§é—®é¢˜

### 1. Token è¿‡æœŸæ€ä¹ˆåŠï¼Ÿ

**AccessToken** æœ‰æ•ˆæœŸä¸º 2 åˆ†é’Ÿï¼Œè¿‡æœŸåä¼šè¿”å› 401 é”™è¯¯ã€‚

**è§£å†³æ–¹æ³•ï¼š**
- ä½¿ç”¨ `refreshToken` mutation è·å–æ–°çš„ token
- RefreshToken æœ‰æ•ˆæœŸä¸º 7 å¤©

### 2. å¦‚ä½•æŸ¥çœ‹å®Œæ•´çš„ GraphQL Schemaï¼Ÿ

åœ¨ GraphQL Playground å³ä¾§ç‚¹å‡» **DOCS** æˆ– **SCHEMA** æ ‡ç­¾ï¼Œå¯ä»¥æŸ¥çœ‹ï¼š
- æ‰€æœ‰å¯ç”¨çš„ queriesï¼ˆæŸ¥è¯¢ï¼‰
- æ‰€æœ‰å¯ç”¨çš„ mutationsï¼ˆå˜æ›´ï¼‰
- æ‰€æœ‰å¯ç”¨çš„ subscriptionsï¼ˆè®¢é˜…ï¼‰
- å®Œæ•´çš„ç±»å‹å®šä¹‰

### 3. ä¸ºä»€ä¹ˆ Swagger åªæ˜¾ç¤ºä¸¤ä¸ªæ¥å£ï¼Ÿ

è¿™æ˜¯æ­£å¸¸çš„ï¼æœ¬é¡¹ç›®ä¸»è¦ä½¿ç”¨ **GraphQL API**ï¼ŒREST API ä»…ç”¨äºå¥åº·æ£€æŸ¥ã€‚

æ‰€æœ‰ä¸šåŠ¡åŠŸèƒ½ï¼ˆè®¤è¯ã€ç”¨æˆ·ã€æ–‡ç« ï¼‰éƒ½é€šè¿‡ GraphQL æä¾›ã€‚

### 4. å¦‚ä½•é‡ç½®æ•°æ®åº“ï¼Ÿ

```bash
# é‡ç½®æ•°æ®åº“ï¼ˆä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
npm run migrate:reset

# é‡æ–°å¡«å……ç§å­æ•°æ®
npm run seed
```

### 5. ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ

ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„ `PORT` å˜é‡ï¼š

```bash
PORT=3001
```

æˆ–åœ¨å¯åŠ¨æ—¶æŒ‡å®šï¼š

```bash
PORT=3001 npm run start:dev
```

### 6. å¦‚ä½•è°ƒè¯• GraphQL æŸ¥è¯¢ï¼Ÿ

GraphQL Playground æä¾›äº†å¼ºå¤§çš„è°ƒè¯•åŠŸèƒ½ï¼š

- âœ… è‡ªåŠ¨è¡¥å…¨ï¼šè¾“å…¥æ—¶æŒ‰ `Ctrl + Space`
- âœ… æ ¼å¼åŒ–ï¼š`Ctrl + Shift + F`ï¼ˆWindowsï¼‰æˆ– `Cmd + Shift + F`ï¼ˆMacï¼‰
- âœ… æŸ¥çœ‹æ–‡æ¡£ï¼šç‚¹å‡»å³ä¾§ DOCS æ ‡ç­¾
- âœ… æŸ¥è¯¢å†å²ï¼šç‚¹å‡»å³ä¸Šè§’æ—¶é’Ÿå›¾æ ‡

---

## å®Œæ•´ä½¿ç”¨æµç¨‹ç¤ºä¾‹

### åœºæ™¯ï¼šåˆ›å»ºå¹¶å‘å¸ƒä¸€ç¯‡æ–‡ç« 

```graphql
# 1. ç™»å½•
mutation Login {
  login(data: {
    email: "bart@simpson.com",
    password: "secret42"
  }) {
    accessToken
    user {
      id
      email
    }
  }
}

# 2. è®¾ç½® HTTP Headersï¼ˆä½¿ç”¨ä¸Šé¢è¿”å›çš„ accessTokenï¼‰
# {
#   "Authorization": "Bearer YOUR_ACCESS_TOKEN"
# }

# 3. åˆ›å»ºæ–‡ç« 
mutation CreatePost {
  createPost(data: {
    title: "GraphQL å…¥é—¨æ•™ç¨‹",
    content: "GraphQL æ˜¯ä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€..."
  }) {
    id
    title
    published
  }
}

# 4. å‘å¸ƒæ–‡ç« ï¼ˆä½¿ç”¨ä¸Šé¢è¿”å›çš„æ–‡ç«  idï¼‰
mutation PublishPost {
  publishPost(postId: "YOUR_POST_ID") {
    id
    title
    published
  }
}

# 5. æŸ¥è¯¢å·²å‘å¸ƒçš„æ–‡ç« 
query PublishedPosts {
  publishedPosts(first: 10) {
    edges {
      node {
        id
        title
        content
        author {
          firstname
          lastname
        }
      }
    }
  }
}
```

---

## æŠ€æœ¯æ ˆ

- **NestJS v11** - Node.js æ¡†æ¶
- **Prisma v6** - ORM å’Œæ•°æ®åº“å·¥å…·
- **GraphQL** - API æŸ¥è¯¢è¯­è¨€
- **Apollo Server v5** - GraphQL æœåŠ¡å™¨
- **PostgreSQL** - å…³ç³»å‹æ•°æ®åº“
- **JWT** - èº«ä»½è®¤è¯
- **TypeScript** - ç±»å‹å®‰å…¨

---

## ç›¸å…³æ–‡æ¡£

- [NestJS å®˜æ–¹æ–‡æ¡£](https://docs.nestjs.com/)
- [Prisma å®˜æ–¹æ–‡æ¡£](https://www.prisma.io/docs/)
- [GraphQL å®˜æ–¹æ–‡æ¡£](https://graphql.org/learn/)
- [Apollo Server æ–‡æ¡£](https://www.apollographql.com/docs/apollo-server/)

---

## éœ€è¦å¸®åŠ©ï¼Ÿ

æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•çš„ä»¥ä¸‹æ–‡ä»¶ï¼š

- `README.md` - é¡¹ç›®æ¦‚è¿°å’Œå®‰è£…è¯´æ˜
- `CLAUDE.md` - å¼€å‘æŒ‡å—å’Œç¼–ç è§„èŒƒ
- `graphql/` - GraphQL æŸ¥è¯¢ç¤ºä¾‹æ–‡ä»¶
  - `auth.graphql` - è®¤è¯ç›¸å…³ç¤ºä¾‹
  - `user.graphql` - ç”¨æˆ·æ“ä½œç¤ºä¾‹
  - `post.graphql` - æ–‡ç« æ“ä½œç¤ºä¾‹

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
